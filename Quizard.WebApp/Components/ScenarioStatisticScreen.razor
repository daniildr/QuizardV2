@using Quizard.Core.Entities
@using Quizard.WebApp.Services
@inject GameService GameService
@inject ILogger<QuestionButtons> Logger

@if (ScenarioStatistic is not null)
{
    <div class="col-12 p-5">
        <div class="row text-start">
            <div class="col-2"></div>
            <div class="col-3">
                @foreach (var statistic in ScenarioStatistic!)
                {
                    <div class="row">
                        <div class="col">
                            <h3>@statistic.Player.Nickname</h3>
                        </div>
                    </div>
                }
            </div>
            <div class="col-1">
                @foreach (var statistic in ScenarioStatistic!)
                {
                    <div class="row">
                        <div class="col">
                            <h3>@statistic.Score</h3>
                        </div>
                    </div>
                }
            </div>
            <div class="col-6"></div>
        </div>
    </div>
}


@code { 
    private ScenarioStatistic[]? ScenarioStatistic { get; set; }
    
    protected override void OnInitialized()
    {
        GameService.OnChange += HandleGameServiceChanged;
    }

    private void HandleGameServiceChanged()
    {
        Logger.LogTrace("[Финишная статистика] Состояние игры - {@G}", GameService);
        if (GameService.ScenarioStatistic != null)
        {
            ScenarioStatistic = GameService.ScenarioStatistic;
        }

        InvokeAsync(StateHasChanged);
    }
}